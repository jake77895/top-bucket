<%
=begin%>
 <div class="modal fade" id="nodeModal" tabindex="-1" aria-labelledby="nodeModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="nodeModalLabel">Exit Opportunities</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Original Details in Accordion -->
        <div class="accordion mb-3" id="detailsAccordion">
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#detailsCollapse">
                Details
              </button>
            </h2>
            <div id="detailsCollapse" class="accordion-collapse collapse" data-bs-parent="#detailsAccordion">
              <div class="accordion-body">
                <p><strong>Industry:</strong> <span id="modal-industry"></span></p>
                <p><strong>Level:</strong> <span id="modal-level"></span></p>
                <p><strong>Number of Records:</strong> <span id="modal-record-count"></span></p>
                <p><strong>Average Salary:</strong> $<span id="modal-avg-salary"></span></p>
                <p><strong>Average Bonus:</strong> $<span id="modal-avg-bonus"></span></p>
                <p><strong>Average Total Compensation:</strong> $<span id="modal-avg-total-comp"></span></p>
                <p><strong>Average Compensation per Hour:</strong> $<span id="modal-avg-comp-per-hour"></span></p>
              </div>
            </div>
          </div>
        </div>

        <!-- Companies Accordion -->
        <div class="accordion" id="companiesAccordion">
          <% @mappings.each do |mapping| %>
            <% mapping.exit_opportunity_details.group_by(&:target_company_name).each do |target_company, details| %>
              <div class="accordion-item">
                <h2 class="accordion-header">
                  <button class="accordion-button collapsed" type="button" 
                          data-bs-toggle="collapse" 
                          data-bs-target="#collapse<%= target_company.parameterize %>">
                    <%= target_company %>
                    <% if mapping.likelihood == 1 %>
                      <span class="badge bg-success ms-2">Likely</span>
                    <% else %>
                      <span class="badge bg-warning ms-2">Possible</span>
                    <% end %>
                  </button>
                </h2>
                <div id="collapse<%= target_company.parameterize %>" 
                     class="accordion-collapse collapse" 
                     data-bs-parent="#companiesAccordion">
                  <div class="accordion-body">
                    <div style="max-height: 200px; overflow-y: auto;">
                      <% details.each do |detail| %>
                        <p class="mb-2">
                          <strong><%= detail.source_company_name %></strong>
                          <% if detail.source_group.present? %>
                            - <%= detail.source_group %>
                          <% end %>
                        </p>
                      <% end %>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
      
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div> 
<%
=end%>
